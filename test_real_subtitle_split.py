#!/usr/bin/env python3
"""
测试真实的字幕分割场景
"""
import sys
sys.path.append('.')

from utils.subtitle_utils import SubtitleUtils

# 真实的场景文本
real_text = "汉朝边陲，一封密函竟能颠覆帝国，你，是大汉西域都护府的译官，精通异族语言，却陷入匈奴与权臣的绞杀局，军帐外，驼铃急促，烽燧狼烟骤起，匈奴单于使者团突然抵达，要求汉朝退出西域，都护将军冷汗浸透犀甲，他瞥向你，低声下令，窃听匈奴使团密谈，你匍匐帐外，沙尘刺鼻，隐约听见，他们提及，朝中高官名讳，你浑身僵冷，意识到，这不是外交博弈，而是里通外敌的死局，归营急报，都护却冷笑，斥你妄言，当夜，粮草营莫名起火，焦臭弥漫，守粮校尉横死帐中，胸口插着匈奴短刀，军心溃散，谣言四起，称你通敌纵火，都护下令将你羁押，镣铐加身，狱中阴湿，腐气刺鼻，你蜷缩草堆，触摸到，一枚蜡丸，藏于衣缝，拆开竟是，兵部尚书与匈奴往来密契，钤印朱红刺目，你颤抖明白，自己成了，替罪羔羊，次日，都护升帐审你，帐外士卒怒目而视，你忽昂首高喝，我有单于亲笔盟书，藏于烽燧台下，都护色变，急派亲信去取，你趁机离间，低语副将，都护欲灭口尔等，副将疑惧后退，你趁机暴起，夺剑斩断镣铐，当众焚毁伪证，灰烬飘散如蝶，震慑全场，你疾书密奏，以血代墨，塞入信鸽脚筒，放飞刹那，箭矢破空，鸽坠沙海，你绝望闭目，却听帐外马蹄如雷，钦差持节骤至，高呼，奉诏查逆，你掏出蜡丸密契，嘶吼，此乃兵部叛国铁证，钦差验印骇然，当即擒拿都护，压入囚车，风波暂平，你却未得封赏，反调离西域，临行夜，你抚摸冰冷箭镞，腥风卷沙扑面，这一刻你终于明白，帝国荣耀背后，权力棋局中，真相不过是，最脆弱的牺牲品。"

print(f"原文长度: {len(real_text)} 字符")

# 测试字幕分割 - 使用12字符限制（实际项目中计算出来的）
max_chars = 12
lines = SubtitleUtils.split_text_by_rules(real_text, max_chars, "zh")

print(f"分割后得到 {len(lines)} 行:")
print("-" * 60)

for i, line in enumerate(lines, 1):
    print(f"{i:2d}: '{line}' (长度: {len(line)})")

# 查找包含"惨"的行
print("\n" + "=" * 60)
print("查找包含'惨'字的行:")
for i, line in enumerate(lines, 1):
    if '惨' in line:
        print(f"行 {i}: '{line}' (长度: {len(line)})")
        # 检查每个字符
        print("字符详情:", [c for c in line])