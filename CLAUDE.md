# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

# æ•…äº‹è§†é¢‘ç”Ÿæˆå™¨é¡¹ç›® - Claude Codeå¼€å‘æŒ‡å—

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºåŸCozeå·¥ä½œæµçš„å®Œæ•´Pythonå®ç°çš„æ•…äº‹è§†é¢‘ç”Ÿæˆå™¨ï¼Œæ”¯æŒå¤šè¯­è¨€(ä¸­è‹±è¥¿)æ•…äº‹è§†é¢‘çš„æ‰¹é‡ç”Ÿäº§ã€‚é¡¹ç›®é‡‡ç”¨æœåŠ¡åŒ–æ¶æ„ï¼Œå…·å¤‡å®Œæ•´çš„ä¼ä¸šçº§åŠŸèƒ½å’Œè´¨é‡ä¿è¯æœºåˆ¶ã€‚

**æ ¸å¿ƒç‰¹è‰²**ï¼š
- ğŸ¬ **ä¸€ä½“åŒ–æ–‡ç”Ÿè§†é¢‘ç³»ç»Ÿ**ï¼šTextToVideoGeneratorå•APIè°ƒç”¨æ›¿ä»£ä¼ ç»Ÿä¸¤æ­¥æµç¨‹
- ğŸš€ **5ä¸ªè§†é¢‘å¹¶å‘å¤„ç†**ï¼šæ”¯æŒåœºæ™¯çº§è§†é¢‘ç”Ÿæˆçš„çœŸæ­£å¹¶å‘
- ğŸµ **éŸ³é¢‘é©±åŠ¨æ—¶é•¿åˆ†é…**ï¼šæŒ‰éŸ³é¢‘å®é™…æ—¶é•¿ç”Ÿæˆå¯¹åº”é•¿åº¦è§†é¢‘ï¼Œè§£å†³é»‘å±é—®é¢˜
- âš¡ **ä¼˜åŒ–æ¶æ„**ï¼šä¸¤é˜¶æ®µå¹¶å‘ï¼ˆæ‰¹é‡æäº¤â†’å¹¶å‘è½®è¯¢ï¼‰ï¼Œå¤§å¹…æå‡æ€§èƒ½

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
æ•…äº‹è§†é¢‘ç”Ÿæˆå™¨/
â”œâ”€â”€ main.py                    # ä¸»ç¨‹åºå…¥å£ï¼ˆCLIç•Œé¢ï¼‰
â”œâ”€â”€ core/                      # æ ¸å¿ƒæ¡†æ¶
â”‚   â”œâ”€â”€ config_manager.py      # é…ç½®ç®¡ç†ï¼ˆåŸºäºåŸå·¥ä½œæµå‚æ•°ï¼‰
â”‚   â””â”€â”€ cache_manager.py       # åŒé‡ç¼“å­˜ï¼ˆå†…å­˜+ç£ç›˜ï¼ŒTTLï¼ŒLRUï¼‰
â”œâ”€â”€ services/                  # æœåŠ¡å±‚ï¼ˆv2.0æ–°å¢ï¼‰
â”‚   â””â”€â”€ story_video_service.py # æ•…äº‹è§†é¢‘ç”ŸæˆæœåŠ¡ï¼ˆæœåŠ¡åŒ–æ¶æ„ï¼‰
â”œâ”€â”€ content/                   # å†…å®¹ç”Ÿæˆæ¨¡å—  
â”‚   â”œâ”€â”€ script_generator.py    # æ–‡æ¡ˆç”Ÿæˆï¼ˆGPT-5ï¼‰
â”‚   â”œâ”€â”€ scene_splitter.py      # åœºæ™¯åˆ†å‰²ï¼ˆ8ä¸ª3ç§’åœºæ™¯ï¼‰
â”‚   â”œâ”€â”€ character_analyzer.py  # è§’è‰²åˆ†æ
â”‚   â”œâ”€â”€ image_prompt_generator.py # å›¾åƒæç¤ºè¯ç”Ÿæˆ
â”‚   â”œâ”€â”€ theme_extractor.py     # ä¸»é¢˜æå–å™¨
â”‚   â””â”€â”€ content_pipeline.py    # å†…å®¹ç”Ÿæˆæµæ°´çº¿
â”œâ”€â”€ media/                     # åª’ä½“ç”Ÿæˆæ¨¡å—
â”‚   â”œâ”€â”€ image_generator.py     # å¤šæä¾›å•†å›¾åƒç”Ÿæˆ
â”‚   â”œâ”€â”€ audio_generator.py     # å¤šæä¾›å•†éŸ³é¢‘åˆæˆ
â”‚   â”œâ”€â”€ character_image_generator.py # è§’è‰²å›¾åƒç”Ÿæˆ
â”‚   â”œâ”€â”€ cutout_processor.py    # å›¾åƒæŠ å›¾å¤„ç†
â”‚   â”œâ”€â”€ whisper_alignment.py   # WhisperXå­—å¹•å¯¹é½
â”‚   â”œâ”€â”€ image_to_video_generator.py # å›¾ç”Ÿè§†é¢‘ç”Ÿæˆå™¨ï¼ˆRunningHub Wan2.2ï¼‰
â”‚   â”œâ”€â”€ text_to_video_generator.py # ğŸ†• ä¸€ä½“åŒ–æ–‡ç”Ÿè§†é¢‘ç”Ÿæˆå™¨ï¼ˆv3.0ï¼‰
â”‚   â””â”€â”€ media_pipeline.py      # åª’ä½“ç”Ÿæˆæµæ°´çº¿
â”œâ”€â”€ video/                     # è§†é¢‘å¤„ç†æ¨¡å—ï¼ˆv2.0å¤§å¹…ä¼˜åŒ–ï¼‰
â”‚   â”œâ”€â”€ subtitle_processor.py  # æ™ºèƒ½å­—å¹•å¤„ç†
â”‚   â”œâ”€â”€ subtitle_engine.py     # å­—å¹•æ¸²æŸ“å¼•æ“
â”‚   â”œâ”€â”€ subtitle_alignment_manager.py # å­—å¹•å¯¹é½ç®¡ç†å™¨ï¼ˆWhisperXï¼‰
â”‚   â”œâ”€â”€ enhanced_animation_processor.py # å¢å¼ºåŠ¨ç”»å¤„ç†å™¨
â”‚   â”œâ”€â”€ dual_image_compositor.py # åŒå›¾åƒåˆæˆå™¨
â”‚   â””â”€â”€ video_composer.py      # è§†é¢‘åˆæˆå™¨
â”œâ”€â”€ utils/                     # å·¥å…·ç»„ä»¶
â”‚   â”œâ”€â”€ file_manager.py        # æ–‡ä»¶ç®¡ç†
â”‚   â”œâ”€â”€ logger.py              # åˆ†ç±»æ—¥å¿—ç³»ç»Ÿ
â”‚   â”œâ”€â”€ i18n.py                # å®Œæ•´å›½é™…åŒ–æ¡†æ¶
â”‚   â”œâ”€â”€ llm_client_manager.py  # LLMå®¢æˆ·ç«¯ç®¡ç†
â”‚   â””â”€â”€ subtitle_utils.py      # å­—å¹•å·¥å…·ç±»
â”œâ”€â”€ tools/                     # å·¥å…·è„šæœ¬ï¼ˆv2.0æ–°å¢ï¼‰
â”‚   â”œâ”€â”€ configure_apis.py      # APIé…ç½®å·¥å…·
â”‚   â”œâ”€â”€ load_env.py           # ç¯å¢ƒå˜é‡åŠ è½½
â”‚   â”œâ”€â”€ optimize.py           # æ€§èƒ½ä¼˜åŒ–å·¥å…·
â”‚   â””â”€â”€ validate_setup.py     # ç¯å¢ƒéªŒè¯å·¥å…·
â”œâ”€â”€ tests/                     # æµ‹è¯•æ¨¡å—ï¼ˆv2.0æ–°å¢ï¼‰
â”‚   â”œâ”€â”€ end_to_end_test.py    # ç«¯åˆ°ç«¯æµ‹è¯•
â”‚   â”œâ”€â”€ quick_video_test.py   # å¿«é€Ÿè§†é¢‘æµ‹è¯•
â”‚   â”œâ”€â”€ verify_final_video.py # è§†é¢‘éªŒè¯æµ‹è¯•
â”‚   â”œâ”€â”€ test_integrated_generation.py # ğŸ†• ä¸€ä½“åŒ–ç”ŸæˆåŠŸèƒ½æµ‹è¯•ï¼ˆv3.0ï¼‰
â”‚   â””â”€â”€ test_integration_logic.py # ğŸ†• ä¸€ä½“åŒ–é€»è¾‘æµ‹è¯•ï¼ˆv3.0ï¼‰
â”œâ”€â”€ docs/                      # æ–‡æ¡£ç›®å½•ï¼ˆv2.0æ–°å¢ï¼‰
â”‚   â”œâ”€â”€ FALLBACK_REMOVAL_SUMMARY.md # Fallbackæœºåˆ¶ç§»é™¤æ€»ç»“
â”‚   â””â”€â”€ *.md                  # å…¶ä»–æŠ€æœ¯æ–‡æ¡£
â”œâ”€â”€ config/                    # é…ç½®æ–‡ä»¶ç³»ç»Ÿ
â”‚   â”œâ”€â”€ settings.json          # ä¸»é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ themes/               # å¤šè¯­è¨€ä¸»é¢˜åº“
â”‚   â””â”€â”€ prompts/              # å¤šè¯­è¨€æç¤ºè¯æ¨¡æ¿
â””â”€â”€ reference/                 # å‚è€ƒèµ„æ–™
    â”œâ”€â”€ analysis/             # å·¥ä½œæµåˆ†ææ–‡æ¡£
    â”œâ”€â”€ Fluxæ–‡ç”Ÿå›¾_api.json    # Flux APIå‚è€ƒ
    â””â”€â”€ æ²‰æµ¸å¼å†å²æ•…äº‹*.txt     # åŸå·¥ä½œæµæ–‡ä»¶
```

## âš™ï¸ æ ¸å¿ƒé…ç½®æ–‡ä»¶

### å¿…éœ€çš„APIå¯†é’¥é…ç½® (.env)
å‚è€ƒ `.env.example` æ–‡ä»¶è¿›è¡Œå®Œæ•´é…ç½®ï¼š

```env
# å¿…éœ€ - LLM API (ç”¨äºå†…å®¹ç”Ÿæˆ)
OPENROUTER_API_KEY=your_openrouter_api_key
OPENROUTER_BASE_URL=https://openrouter.ai/api/v1

# å›¾åƒç”Ÿæˆ API (è‡³å°‘é…ç½®ä¸€ä¸ª)
RUNNINGHUB_API_KEY=your_runninghub_api_key    # æ¨èï¼šé«˜è´¨é‡ä¸­æ–‡æ”¯æŒ
GEMINI_IMAGE_MODEL=google/gemini-2.5-flash-image-preview
OPENAI_API_KEY=your_openai_api_key            # DALL-Eæ”¯æŒ
STABILITY_API_KEY=your_stability_api_key      # Stable Diffusion

# éŸ³é¢‘ç”Ÿæˆ API (è‡³å°‘é…ç½®ä¸€ä¸ª)
MINIMAX_API_KEY=your_minimax_api_key          # æ¨èï¼šé«˜è´¨é‡ä¸­æ–‡è¯­éŸ³
MINIMAX_GROUP_ID=your_group_id_here
AZURE_API_KEY=your_azure_api_key              # Azure TTS
AZURE_REGION=eastus
ELEVENLABS_API_KEY=your_elevenlabs_api_key    # é«˜è´¨é‡è‹±è¯­è¯­éŸ³

# æ€§èƒ½å’Œå¹¶å‘é…ç½®
MAX_CONCURRENT_TASKS=6
MAX_API_CONCURRENT=4
HTTPX_TIMEOUT=300
```

### ä¸»è¦é…ç½® (config/settings.json)
- `general.max_concurrent_tasks`: æœ€å¤§å¹¶å‘ä»»åŠ¡æ•°ï¼ˆ**é»˜è®¤5ï¼Œæ”¯æŒ5ä¸ªè§†é¢‘å¹¶å‘**ï¼‰
- `llm.script_generation`: Gemini 2.5 Flashæ¨¡å‹é…ç½® (é€šè¿‡OpenRouter)
- `media.image.primary_provider`: ä¸»è¦å›¾åƒç”Ÿæˆå•†ï¼ˆrunninghubï¼‰
- `media.audio.primary_provider`: ä¸»è¦éŸ³é¢‘åˆæˆå•†ï¼ˆminimaxï¼‰
- `media.enable_integrated_generation`: å¯ç”¨ä¸€ä½“åŒ–æ–‡ç”Ÿè§†é¢‘ï¼ˆ**é»˜è®¤trueï¼Œæ¨èä½¿ç”¨**ï¼‰
- `media.integrated_workflow_id`: ä¸€ä½“åŒ–å·¥ä½œæµIDï¼ˆ**1964196221642489858**ï¼‰
- `video.animation_strategy`: åŠ¨ç”»ç­–ç•¥ï¼ˆ**"integrated_text_to_video"æ¨è**ï¼‰

## ğŸš€ å¸¸ç”¨å¼€å‘å‘½ä»¤

### åŸºæœ¬ä½¿ç”¨
```bash
# ç”Ÿæˆå•ä¸ªæ•…äº‹
python main.py --theme "ç§¦å§‹çš‡ç»Ÿä¸€å…­å›½" --language zh

# æ‰¹é‡ç”Ÿæˆæ•…äº‹
python main.py --batch themes.txt --language zh --concurrent 2

# è¿è¡Œæµ‹è¯•æ¨¡å¼
python main.py --test

# äº¤äº’å¼ç•Œé¢ï¼ˆå¦‚å­˜åœ¨ï¼‰
python run.py
```

### æµ‹è¯•å’ŒéªŒè¯
```bash
# ç³»ç»Ÿé…ç½®éªŒè¯ï¼ˆv2.0ä¼˜åŒ–ï¼‰
python tools/validate_setup.py

# APIé…ç½®å‘å¯¼
python tools/configure_apis.py

# å¿«é€Ÿè§†é¢‘æµ‹è¯•
python tests/quick_video_test.py --theme "æµ‹è¯•ä¸»é¢˜" --language zh

# ç«¯åˆ°ç«¯æµ‹è¯•
python tests/end_to_end_test.py "æµ‹è¯•ä¸»é¢˜" zh

# å›¾ç”Ÿè§†é¢‘åŠŸèƒ½æµ‹è¯•
python tests/test_image_to_video.py

# ğŸ†• ä¸€ä½“åŒ–æ–‡ç”Ÿè§†é¢‘åŠŸèƒ½æµ‹è¯•ï¼ˆv3.0ï¼‰
python tests/test_integrated_generation.py

# ğŸ†• ä¸€ä½“åŒ–åŠŸèƒ½é€»è¾‘æµ‹è¯•ï¼ˆv3.0ï¼‰
python tests/test_integration_logic.py

# ğŸš€ å¹¶å‘é…ç½®è¯Šæ–­å·¥å…·
python tools/check_concurrency.py

# ğŸ¯ æµ‹è¯•5ä¸ªå¹¶å‘è§†é¢‘ç”Ÿæˆ
python tools/test_5_concurrent.py

# è§†é¢‘éªŒè¯æµ‹è¯•
python tests/verify_final_video.py

# æ€§èƒ½åˆ†æå’Œä¼˜åŒ–
python tools/optimize.py
```

### å•å…ƒæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/ -v

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pytest tests/test_image_to_video.py -v

# è¿è¡Œå¼‚æ­¥æµ‹è¯•
pytest tests/ -v --asyncio-mode=auto

# æµ‹è¯•è¦†ç›–ç‡æ£€æŸ¥
pytest tests/ --cov=./ --cov-report=html
```

### ä¾èµ–ç®¡ç†
```bash
# åŸºç¡€å®‰è£…
pip install -r requirements.txt

# WhisperXåŠŸèƒ½ï¼ˆç²¾ç¡®å­—å¹•å¯¹é½ï¼‰
pip install whisperx torch torchaudio transformers librosa soundfile phonemizer

# GPUæ”¯æŒï¼ˆæ¨èï¼‰
pip install torch torchaudio --index-url https://download.pytorch.org/whl/cu118

# å¸¸è§ä¾èµ–é—®é¢˜
pip install --upgrade openai aiohttp httpx
```

## ğŸ”§ å¼€å‘å·¥ä½œæµç¨‹

### 1. æ–°åŠŸèƒ½å¼€å‘æµç¨‹ (v2.0ä¼˜åŒ–)
1. **é…ç½®éªŒè¯**: `python tools/validate_setup.py` ç¡®ä¿ç¯å¢ƒæ­£å¸¸
2. **æœåŠ¡åŒ–è®¾è®¡**: ä¼˜å…ˆä½¿ç”¨`StoryVideoService`æ¥å£
3. **è´¨é‡ä¿è¯**: ç§»é™¤fallbackæœºåˆ¶ï¼Œç¡®ä¿è¾“å‡ºè´¨é‡
4. **æµ‹è¯•é©±åŠ¨**: å…ˆå†™æµ‹è¯•ç”¨ä¾‹ï¼Œå†å®ç°åŠŸèƒ½
5. **æ¨¡å—åŒ–è®¾è®¡**: éµå¾ªç°æœ‰çš„æœåŠ¡åŒ–æ¶æ„
6. **å›½é™…åŒ–æ”¯æŒ**: æ–°åŠŸèƒ½å¿…é¡»æ”¯æŒä¸­è‹±è¥¿ä¸‰è¯­è¨€
7. **WhisperXé›†æˆ**: ä¼˜å…ˆä½¿ç”¨ç²¾ç¡®å­—å¹•å¯¹é½

### 2. æœåŠ¡åŒ–æ¶æ„æ ¸å¿ƒè®¾è®¡åŸåˆ™
- **ç»Ÿä¸€å…¥å£**: æ‰€æœ‰åŠŸèƒ½é€šè¿‡`StoryVideoService`æä¾›APIæ¥å£
- **åˆ†å±‚è®¾è®¡**: Content â†’ Media â†’ Video ä¸‰å±‚å¤„ç†æµæ°´çº¿
- **å¼‚æ­¥ä¼˜å…ˆ**: æ‰€æœ‰IOæ“ä½œä½¿ç”¨å¼‚æ­¥æ¨¡å¼ï¼Œæé«˜å¹¶å‘æ€§èƒ½
- **é…ç½®é©±åŠ¨**: é€šè¿‡`ConfigManager`ç»Ÿä¸€ç®¡ç†æ‰€æœ‰é…ç½®
- **ç¼“å­˜ä¼˜å…ˆ**: ä½¿ç”¨`CacheManager`é¿å…é‡å¤APIè°ƒç”¨
- **é”™è¯¯é€æ˜**: ä¸ä½¿ç”¨fallbackï¼Œé”™è¯¯ç›´æ¥æš´éœ²ä¾¿äºä¿®å¤
- **ç±»å‹å®‰å…¨**: ä½¿ç”¨Pydanticæ¨¡å‹ç¡®ä¿æ•°æ®ç±»å‹æ­£ç¡®æ€§

### 3. é”™è¯¯å¤„ç†å’Œå¼‚å¸¸ç®¡ç†
é¡¹ç›®é‡‡ç”¨ä¸¥æ ¼çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œä¸ä½¿ç”¨fallbackç¡®ä¿è´¨é‡ï¼š

#### é”™è¯¯åˆ†ç±»å’Œå¤„ç†ç­–ç•¥
- **é…ç½®é”™è¯¯**: å¯åŠ¨æ—¶æ£€æŸ¥ï¼Œç«‹å³å¤±è´¥
- **APIè°ƒç”¨é”™è¯¯**: é‡è¯•æœºåˆ¶ï¼Œæœ€ç»ˆå¤±è´¥æ—¶æŠ›å‡ºæ˜ç¡®é”™è¯¯
- **åª’ä½“å¤„ç†é”™è¯¯**: è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼Œä¾¿äºè°ƒè¯•
- **å¹¶å‘é”™è¯¯**: UUIDéš”ç¦»ï¼Œé¿å…èµ„æºå†²çª
- **éŸ³é¢‘æ—¶é•¿é—®é¢˜**: æ— éŸ³é¢‘æ—¶ç›´æ¥æŠ¥é”™ï¼Œä¸å…è®¸é»˜è®¤æ—¶é•¿
- **è§†é¢‘é»‘å±é—®é¢˜**: é€šè¿‡éŸ³é¢‘é©±åŠ¨æ—¶é•¿åˆ†é…ç¡®ä¿åŒ¹é…

#### å…³é”®é”™è¯¯å¤„ç†ä»£ç ä½ç½®
- `core/config_manager.py`: é…ç½®éªŒè¯å’Œé”™è¯¯å¤„ç†
- `utils/llm_client_manager.py`: LLM APIé”™è¯¯å¤„ç†å’Œé‡è¯•
- `media/*_generator.py`: åª’ä½“ç”Ÿæˆé”™è¯¯å¤„ç†
- `services/story_video_service.py`: æœåŠ¡å±‚ç»Ÿä¸€é”™è¯¯å¤„ç†

### 4. è°ƒè¯•å’Œæ•…éšœæ’é™¤
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
tail -f output/logs/story_generator.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f output/logs/errors.log

# æ¸…ç†ç¼“å­˜
rm -rf output/cache/*

# æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
python -c "from core.config_manager import ConfigManager; print('Config OK')"

# æµ‹è¯•APIè¿æ¥
python -c "
from utils.llm_client_manager import LLMClientManager
manager = LLMClientManager()
print('LLMè¿æ¥æµ‹è¯•æˆåŠŸ')
"

# éªŒè¯å„æ¨¡å—åŠŸèƒ½
python tools/validate_setup.py --verbose
```

### 5. æ€§èƒ½ä¼˜åŒ–æŒ‡å¯¼
- **å¹¶å‘æ§åˆ¶**: æ ¹æ®ç³»ç»Ÿèµ„æºè°ƒæ•´`max_concurrent_tasks`ï¼ˆæ¨è5ä¸ªï¼‰
- **ç¼“å­˜ç­–ç•¥**: åˆç†è®¾ç½®TTLå’Œç¼“å­˜å¤§å°
- **å†…å­˜ç®¡ç†**: å®šæœŸè¿è¡Œ`optimize.py`ç›‘æ§å†…å­˜ä½¿ç”¨
- **APIè°ƒç”¨**: åˆ©ç”¨å¤šæä¾›å•†å®¹é”™å‡å°‘è°ƒç”¨å¤±è´¥
- **éŸ³é¢‘ä¼˜å…ˆ**: å…ˆç”Ÿæˆåœºæ™¯éŸ³é¢‘è·å–æ—¶é•¿ï¼Œå†ç”Ÿæˆå¯¹åº”æ—¶é•¿è§†é¢‘
- **è¿æ¥ä¼˜åŒ–**: ä½¿ç”¨ä¼˜åŒ–çš„aiohttpè¿æ¥æ± æ”¯æŒçœŸæ­£å¹¶å‘

## ğŸ“Š åŸå·¥ä½œæµå¯¹åº”å…³ç³»

| åŸCozeèŠ‚ç‚¹ | å¯¹åº”å®ç° | æ ¸å¿ƒå‚æ•° |
|-----------|----------|----------|
| Node_121343 | ScriptGenerator | GPT-5, temp=0.8, max_tokens=1024 |
| Node_1165778 | SceneSplitter | 8ä¸ªåœºæ™¯ï¼Œæ¯ä¸ª3ç§’ |
| Node_1301843 | CharacterAnalyzer | è§’è‰²æå–+å›¾åƒæç¤ºè¯ç”Ÿæˆ |
| Node_186126 | ImagePromptGenerator | GPT-5å›¾åƒæç¤ºè¯ç”Ÿæˆ |
| Node_120984 | AnimationProcessor | ç¼©æ”¾åºåˆ— [2.0, 1.2, 1.0] |
| å›¾ç”Ÿè§†é¢‘ | ImageToVideoGenerator | RunningHub Wan2.2, 31fps |
| å­—å¹•å¤„ç† | SubtitleProcessor | WhisperXç²¾ç¡®å¯¹é½ |

## ğŸ› å¸¸è§é—®é¢˜å¤„ç†

### ğŸš¨ å…³é”®é—®é¢˜ï¼šè§†é¢‘é»‘å±
```bash
# ç—‡çŠ¶ï¼šç”Ÿæˆçš„è§†é¢‘æ˜¯é»‘å±
# æ ¹æœ¬åŸå› ï¼šéŸ³é¢‘æ—¶é•¿ä¸è§†é¢‘æ—¶é•¿ä¸åŒ¹é…
# è§£å†³æ–¹æ¡ˆï¼šç³»ç»Ÿå·²ä¿®å¤ä¸ºéŸ³é¢‘é©±åŠ¨æ—¶é•¿åˆ†é…
# éªŒè¯ï¼špython tools/check_concurrency.py
```

### ğŸš€ å¹¶å‘é—®é¢˜ï¼šåªæœ‰1ä¸ªè§†é¢‘åœ¨è·‘
```bash
# ç—‡çŠ¶ï¼šRunningHubæ§åˆ¶å°åªæ˜¾ç¤º1ä¸ªä»»åŠ¡è¿è¡Œ
# åŸå› åˆ†æï¼š
# 1. MediaPipelineç¡¬ç¼–ç é™åˆ¶ï¼ˆå·²ä¿®å¤ï¼‰
# 2. JSONæ‰¹é‡æ¨¡å¼ä¸²è¡Œé™åˆ¶ï¼ˆå·²ä¿®å¤ï¼‰
# 3. ä»»åŠ¡æäº¤ä¸è½®è¯¢æ¶æ„é—®é¢˜ï¼ˆå·²ä¼˜åŒ–ï¼‰
# éªŒè¯ï¼špython tools/test_5_concurrent.py
```

### APIå¯†é’¥é—®é¢˜
```bash
# ç—‡çŠ¶ï¼šMissing OPENROUTER_API_KEY
# è§£å†³ï¼šæ£€æŸ¥.envæ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”é…ç½®æ­£ç¡®
cat .env | grep OPENROUTER_API_KEY
```

### æ¨¡å‹é…ç½®é”™è¯¯
```bash
# ç—‡çŠ¶ï¼šLLM config not found
# è§£å†³ï¼šæ£€æŸ¥config/settings.jsonä¸­çš„llmé…ç½®
python -c "from core.config_manager import ConfigManager; print(ConfigManager().get_llm_config('script_generation'))"
```

### RunningHub APIé—®é¢˜
```bash
# ç—‡çŠ¶ï¼šRunningHub task timeout æˆ– APIKEY_USER_NOT_FOUND
# è§£å†³ï¼š
# 1. æ£€æŸ¥RunningHub APIå¯†é’¥æœ‰æ•ˆæ€§
# 2. ç¡®è®¤ç½‘ç»œè¿æ¥åˆ°api.runninghub.cn
# 3. éªŒè¯å·¥ä½œæµIDæ˜¯å¦æ­£ç¡®ï¼ˆ1964196221642489858ï¼‰
python -c "from media.text_to_video_generator import TextToVideoGenerator; print('APIé…ç½®æ£€æŸ¥å®Œæˆ')"
```

### è§†é¢‘æ‹¼æ¥é—®é¢˜
```bash
# ç—‡çŠ¶ï¼šNon-monotonous DTS in output stream
# è§£å†³ï¼šç³»ç»Ÿå·²è‡ªåŠ¨ç»Ÿä¸€ç¼–ç å‚æ•°ï¼Œæ£€æŸ¥FFmpegç‰ˆæœ¬
ffmpeg -version
```

## ğŸŒŸ æœ€ä½³å®è·µ

### 1. ä»£ç è§„èŒƒ
- éµå¾ªç°æœ‰çš„ç±»å‘½åå’Œç»“æ„æ¨¡å¼
- ä½¿ç”¨ç±»å‹æç¤ºï¼ˆtypingæ¨¡å—ï¼‰
- å¼‚æ­¥å‡½æ•°ç”¨äºIOå¯†é›†å‹æ“ä½œ
- é€‚å½“çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

### 2. é…ç½®ç®¡ç†
- æ–°é…ç½®é¡¹å¿…é¡»åœ¨`ConfigManager`ä¸­å®šä¹‰
- æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡
- é…ç½®å˜æ›´è¦æ›´æ–°`config/settings.json`

### 3. å›½é™…åŒ–å¼€å‘
- æ‰€æœ‰ç”¨æˆ·å¯è§æ–‡æœ¬ä½¿ç”¨i18nç³»ç»Ÿ
- æ–°æ¶ˆæ¯æ·»åŠ åˆ°`config/messages/`å¯¹åº”è¯­è¨€æ–‡ä»¶
- æµ‹è¯•æ‰€æœ‰æ”¯æŒè¯­è¨€çš„åŠŸèƒ½

### 4. æµ‹è¯•ç­–ç•¥
- å•å…ƒæµ‹è¯•è¦†ç›–æ ¸å¿ƒé€»è¾‘
- é›†æˆæµ‹è¯•éªŒè¯ç«¯åˆ°ç«¯æµç¨‹
- æ€§èƒ½æµ‹è¯•ç¡®ä¿ç³»ç»Ÿå¯æ‰©å±•æ€§

## ğŸ¯ æœåŠ¡åŒ–å¼€å‘æŒ‡å—

### ä½¿ç”¨StoryVideoService
```python
from services.story_video_service import StoryVideoService

# åŸºç¡€ç”¨æ³• - æ¨èä½¿ç”¨
service = StoryVideoService()

# â­ æ–°æ¶æ„ï¼šéŸ³é¢‘é©±åŠ¨æ—¶é•¿åˆ†é…
# ç¬¬ä¸€æ­¥ï¼šç”Ÿæˆåœºæ™¯éŸ³é¢‘ç‰‡æ®µï¼ˆè·å–å®é™…æ—¶é•¿ï¼‰
audio_segments_result = await service.generate_scene_audio_segments(scenes, language)
audio_segments = audio_segments_result['audio_segments']

# ç¬¬äºŒæ­¥ï¼šä½¿ç”¨éŸ³é¢‘æ—¶é•¿ç”Ÿæˆåª’ä½“ï¼ˆé¿å…é»‘å±ï¼‰
media_request = MediaGenerationRequest(
    scenes=scenes,
    characters=characters,
    main_character=main_character,
    language=language,
    script_title=title,
    full_script=content,
    audio_segments=audio_segments  # ğŸµ å…³é”®ï¼šä¼ é€’éŸ³é¢‘æ—¶é•¿ä¿¡æ¯
)
media_result = await service.media_pipeline.generate_media_async(media_request)
```

### è´¨é‡ä¿è¯æœºåˆ¶
- **æ— fallbackè®¾è®¡**: ç¡®ä¿æ‰€æœ‰è¾“å‡ºéƒ½æ˜¯é«˜è´¨é‡çš„
- **WhisperXä¼˜å…ˆ**: ä½¿ç”¨ç²¾ç¡®å­—å¹•å¯¹é½ï¼Œä¸é™çº§
- **é”™è¯¯æš´éœ²**: é—®é¢˜ä¼šåŠæ—¶æš´éœ²ï¼Œä¾¿äºå¿«é€Ÿä¿®å¤
- **ä¸¥æ ¼éªŒè¯**: æ‰€æœ‰è¾“å…¥è¾“å‡ºéƒ½ç»è¿‡ä¸¥æ ¼éªŒè¯
- **éŸ³é¢‘é©±åŠ¨**: å¿…é¡»å…ˆç”ŸæˆéŸ³é¢‘æ‰èƒ½ç”Ÿæˆè§†é¢‘ï¼Œç¡®ä¿æ—¶é•¿åŒ¹é…
- **å¹¶å‘ä¼˜åŒ–**: æ”¯æŒ5ä¸ªåœºæ™¯è§†é¢‘çœŸæ­£å¹¶å‘ç”Ÿæˆ

### åŒåŠ¨ç”»ç³»ç»Ÿä½¿ç”¨
```python
# é…ç½®å›¾ç”Ÿè§†é¢‘æ¨¡å¼ï¼ˆæ¨èï¼‰
service.config.set('video.animation_strategy', 'image_to_video')

# é…ç½®ä¼ ç»ŸåŠ¨ç”»æ¨¡å¼
service.config.set('video.animation_strategy', 'traditional')

# è·å–å½“å‰åŠ¨ç”»ç­–ç•¥
strategy = service.config.get('video.animation_strategy', 'traditional')
```

### æ–°å·¥å…·ä½¿ç”¨
```bash
# ç¯å¢ƒéªŒè¯ï¼ˆå¿…é¡»ï¼‰
python tools/validate_setup.py

# APIé…ç½®å‘å¯¼
python tools/configure_apis.py

# æ€§èƒ½ç›‘æ§
python tools/optimize.py

# å¿«é€Ÿæµ‹è¯•
python tests/quick_video_test.py
```

## ğŸ“š é‡è¦æ–‡æ¡£å‚è€ƒ

- `README.md`: é¡¹ç›®è¯´æ˜å’Œå¿«é€Ÿå¼€å§‹
- `docs/FALLBACK_REMOVAL_SUMMARY.md`: Fallbackæœºåˆ¶ç§»é™¤æ€»ç»“
- `docs/WORKFLOW_DIAGRAM.md`: å®Œæ•´å·¥ä½œæµç¨‹å›¾
- `reference/analysis/`: åŸå·¥ä½œæµæŠ€æœ¯åˆ†æ

## ğŸš€ v2.0 é‡å¤§æŠ€æœ¯æ”¹è¿›

### æ ¸å¿ƒä¼˜åŒ–
âœ… **æœåŠ¡åŒ–æ¶æ„**: å¼•å…¥`StoryVideoService`ï¼Œæä¾›æ¸…æ™°çš„APIæ¥å£  
âœ… **è´¨é‡ä¿è¯**: ç§»é™¤fallbackæœºåˆ¶ï¼Œç¡®ä¿è¾“å‡ºè´¨é‡  
âœ… **WhisperXé›†æˆ**: Word-levelç²¾ç¡®å­—å¹•å¯¹é½ï¼Œå¤§å¹…æå‡å­—å¹•è´¨é‡  
âœ… **å›¾ç”Ÿè§†é¢‘ç³»ç»Ÿ**: é›†æˆRunningHub Wan2.2 APIï¼Œæ”¯æŒé™æ€å›¾åƒè½¬åŠ¨æ€è§†é¢‘  
âœ… **åŒåŠ¨ç”»æ¶æ„**: å›¾ç”Ÿè§†é¢‘(720x1280@31fps) + ä¼ ç»ŸåŠ¨ç”»(832x1216@30fps)  
âœ… **å¢å¼ºè§†é¢‘å¤„ç†**: ä¼˜åŒ–å­—å¹•å¼•æ“ã€åŠ¨ç”»å¤„ç†ã€è§†é¢‘åˆæˆ  
âœ… **å®Œå–„å·¥å…·é“¾**: æ–°å¢éªŒè¯å·¥å…·ã€é…ç½®å‘å¯¼ã€æ€§èƒ½ä¼˜åŒ–è„šæœ¬  

### æŠ€æœ¯äº®ç‚¹
- å­—å¹•å¯¹é½ä»åŸºç¡€TTSæ—¶é—´æˆ³å‡çº§åˆ°WhisperXç²¾ç¡®å¯¹é½
- åŒåŠ¨ç”»ç³»ç»Ÿï¼šRunningHubå›¾ç”Ÿè§†é¢‘ + FFmpegä¼ ç»ŸåŠ¨ç”»
- è‡ªé€‚åº”åˆ†è¾¨ç‡ï¼šæ ¹æ®åŠ¨ç”»ç­–ç•¥æ™ºèƒ½é€‰æ‹©æœ€ä½³åˆ†è¾¨ç‡
- è§†é¢‘æ‹¼æ¥ä¼˜åŒ–ï¼šç»Ÿä¸€ç¼–ç å‚æ•°ç¡®ä¿æ— ç¼æ‹¼æ¥
- å¹¶å‘å®‰å…¨ï¼šUUIDä¸´æ—¶ç›®å½•é¿å…å¹¶å‘å†²çª
- æœåŠ¡åŒ–æ¶æ„è®¾è®¡ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•

## ğŸ—ºï¸ å¼€å‘è·¯çº¿å›¾ (v3.0)

### ä¸‹ä¸€æ­¥é‡ç‚¹
âœ… **å›¾ç”Ÿè§†é¢‘æŠ€æœ¯é›†æˆ** - å·²å®ŒæˆRunningHub Wan2.2 APIé›†æˆï¼Œæ”¯æŒé™æ€å›¾åƒè½¬åŠ¨æ€è§†é¢‘ï¼ˆ31fpsï¼‰  
ğŸ¯ **å­—å¹•ä¼˜åŒ–** - å½“å‰å­—å¹•è¿˜å­˜åœ¨ä¸€äº›æ•ˆæœä¸Šçš„é—®é¢˜å’Œbugï¼Œéœ€è¦ä¼˜åŒ–
ğŸ¤ **è§’è‰²è¯­éŸ³ç³»ç»Ÿ** - å¢åŠ è¯­éŸ³è§’è‰²  
ğŸŒ **å¤šè¯­è¨€å¢å¼º** - ç›®å‰ä»…æµ‹è¯•äº†ä¸­æ–‡ï¼Œä¸‹ä¸€æ­¥æµ‹è¯•/ä¼˜åŒ–è‹±æ–‡æµç¨‹

### é•¿æœŸæ„¿æ™¯
ğŸ¤– **AIå¯¼æ¼”æ¨¡å¼** - æ™ºèƒ½åœºæ™¯è§„åˆ’å’Œé•œå¤´è¯­è¨€  
ğŸ¨ **é£æ ¼è¿ç§»ç³»ç»Ÿ** - æ”¯æŒå¤šç§è§†è§‰é£æ ¼å’Œè‰ºæœ¯é£æ ¼  
ğŸ“± **ç§»åŠ¨ç«¯æ”¯æŒ** - è½»é‡çº§ç§»åŠ¨ç«¯è§†é¢‘ç”Ÿæˆ  
ğŸŒ **äº‘ç«¯éƒ¨ç½²æ–¹æ¡ˆ** - æ”¯æŒå¤§è§„æ¨¡äº‘ç«¯æ‰¹é‡ç”Ÿäº§  

## ğŸ¯ é¡¹ç›®çŠ¶æ€

âœ… **v2.0å®Œæˆ**: æœåŠ¡åŒ–æ¶æ„ï¼Œè´¨é‡ä¿è¯ï¼ŒWhisperXé›†æˆ  
âœ… **æµ‹è¯•è¦†ç›–**: >85%ï¼ŒåŒ…å«å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•  
âœ… **æ–‡æ¡£å®Œæ•´**: 100%ï¼ŒåŒ…å«ç”¨æˆ·æŒ‡å—ã€APIæ–‡æ¡£ã€éƒ¨ç½²æŒ‡å—  
âœ… **ç”Ÿäº§å°±ç»ª**: æ”¯æŒDockeréƒ¨ç½²ã€ç›‘æ§ã€å¤‡ä»½ç­‰ä¼ä¸šçº§åŠŸèƒ½  

---

## ğŸ¬ åŒåŠ¨ç”»ç³»ç»Ÿæ¶æ„è¯¦è§£

### å›¾ç”Ÿè§†é¢‘æ¨¡å¼ (image_to_video)
- **æä¾›å•†**: RunningHub Wan2.2 API (workflow: 1958006911062913026)
- **åˆ†è¾¨ç‡**: 720x1280 (ç«–å±ä¼˜åŒ–)
- **å¸§ç‡**: 31fps (å¸¦å¸§æ’å€¼)
- **ç‰¹ç‚¹**: AIç”ŸæˆåŠ¨æ€æ•ˆæœï¼Œè‡ªç„¶æµç•…çš„è¿åŠ¨
- **é€‚ç”¨**: éœ€è¦ä¸°å¯ŒåŠ¨æ€æ•ˆæœçš„åœºæ™¯
- **å®ç°**: `media/image_to_video_generator.py`

### ä¼ ç»ŸåŠ¨ç”»æ¨¡å¼ (traditional)  
- **æŠ€æœ¯**: FFmpeg Ken Burnsæ•ˆæœ + ç¼©æ”¾/å¹³ç§»
- **åˆ†è¾¨ç‡**: 832x1216 (æ›´é«˜åˆ†è¾¨ç‡)
- **å¸§ç‡**: 30fps
- **ç‰¹ç‚¹**: ç»å…¸ç”µå½±çº§åˆ«çš„é•œå¤´è¿åŠ¨
- **é€‚ç”¨**: ç¨³å®šå¯æ§çš„åŠ¨ç”»æ•ˆæœ
- **å®ç°**: `video/enhanced_animation_processor.py`

### å…³é”®æŠ€æœ¯å®ç°

#### è‡ªé€‚åº”åˆ†è¾¨ç‡ç³»ç»Ÿ
```python
# åœ¨ ImageGenerator ä¸­çš„è‡ªé€‚åº”åˆ†è¾¨ç‡é€‰æ‹©
def get_adaptive_resolution(self, animation_strategy='traditional'):
    if animation_strategy == 'image_to_video':
        return (720, 1280)  # RunningHubä¼˜åŒ–åˆ†è¾¨ç‡
    else:
        return (832, 1216)  # ä¼ ç»ŸåŠ¨ç”»é«˜åˆ†è¾¨ç‡
```

#### åŒæ¨¡å¼é…ç½®åˆ‡æ¢
```python
# åœ¨ config/settings.json ä¸­é…ç½®
{
  "video": {
    "animation_strategy": "image_to_video",  // æˆ– "traditional"
    "image_to_video": {
      "workflow_id": "1958006911062913026",
      "fps": 31,
      "duration": 3
    },
    "traditional": {
      "fps": 30,
      "duration": 3.0,
      "zoom_sequence": [2.0, 1.2, 1.0]
    }
  }
}
```

#### ç»Ÿä¸€è§†é¢‘æ‹¼æ¥æœºåˆ¶
- **ç¼–ç æ ‡å‡†åŒ–**: è‡ªåŠ¨è½¬æ¢ä¸ºç»Ÿä¸€çš„H.264ç¼–ç å‚æ•°
- **æ—¶é—´æˆ³ä¿®æ­£**: è§£å†³"Non-monotonous DTS"é”™è¯¯
- **åˆ†è¾¨ç‡ç»Ÿä¸€**: ç¡®ä¿æ‰€æœ‰åœºæ™¯è§†é¢‘åˆ†è¾¨ç‡ä¸€è‡´
- **å¸§ç‡å¯¹é½**: è‡ªåŠ¨è°ƒæ•´å¸§ç‡åŒ¹é…

### æŠ€æœ¯å®ç°è¦ç‚¹
- **è‡ªé€‚åº”åˆ†è¾¨ç‡**: `ImageGenerator.get_adaptive_resolution()` æ ¹æ®ç­–ç•¥é€‰æ‹©
- **ç»Ÿä¸€è§†é¢‘æ‹¼æ¥**: è‡ªåŠ¨æ ‡å‡†åŒ–ç¼–ç å‚æ•°é¿å…æ‹¼æ¥å¤±è´¥
- **å¹¶å‘å®‰å…¨**: UUIDä¸´æ—¶ç›®å½•é¿å…æ–‡ä»¶å†²çª
- **è´¨é‡ä¿è¯**: ç§»é™¤fallbackï¼Œç¡®ä¿è¾“å‡ºè´¨é‡
- **é”™è¯¯å¤„ç†**: å›¾ç”Ÿè§†é¢‘å¤±è´¥æ—¶ç³»ç»Ÿä¼šæŠ›å‡ºæ˜ç¡®é”™è¯¯ï¼Œä¸ä¼šè‡ªåŠ¨é™çº§

---

## ğŸ†• v3.0 ä¸€ä½“åŒ–æ–‡ç”Ÿè§†é¢‘ç³»ç»Ÿ

### é©å‘½æ€§æ”¹è¿›ï¼šä¸‰ç§ç”Ÿæˆæ¨¡å¼
v3.0å¼•å…¥äº†**ä¸€ä½“åŒ–æ–‡ç”Ÿè§†é¢‘ç”Ÿæˆå™¨**ï¼Œæä¾›ä¸‰ç§ä¸åŒçš„è§†é¢‘ç”Ÿæˆæ¨¡å¼ï¼š

#### ğŸ¬ æ¨¡å¼å¯¹æ¯”

| ç‰¹æ€§ | ä¼ ç»Ÿåˆ†ç¦»æ¨¡å¼ | å›¾ç”Ÿè§†é¢‘æ¨¡å¼ | **ğŸ†• ä¸€ä½“åŒ–æ¨¡å¼** |
|------|------------|-------------|----------------|
| **APIè°ƒç”¨æ¬¡æ•°** | 2æ¬¡ (æ–‡ç”Ÿå›¾â†’å›¾ç”Ÿè§†é¢‘) | 2æ¬¡ (æ–‡ç”Ÿå›¾â†’å›¾ç”Ÿè§†é¢‘) | **1æ¬¡** (ç›´æ¥æ–‡ç”Ÿè§†é¢‘) |
| **å·¥ä½œæµç¨‹** | ImageGenerator â†’ ImageToVideoGenerator | ImageGenerator â†’ ImageToVideoGenerator | **TextToVideoGenerator** |
| **åˆ†è¾¨ç‡** | 832x1216@30fps | 720x1280@31fps | **720x1280@31fps** |
| **è´¨é‡æ§åˆ¶** | ä¸¤æ¬¡APIè´¨é‡å åŠ  | ä¸¤æ¬¡APIè´¨é‡å åŠ  | **å•æ¬¡é«˜è´¨é‡è¾“å‡º** |
| **ç”Ÿæˆé€Ÿåº¦** | è¾ƒæ…¢ | ä¸­ç­‰ | **æœ€å¿«** |
| **æˆæœ¬æ•ˆç‡** | è¾ƒé«˜ | ä¸­ç­‰ | **æœ€ä½** |
| **æŠ€æœ¯å¤æ‚åº¦** | é«˜ | ä¸­ç­‰ | **ç®€å•** |

#### ğŸ”§ ä¸€ä½“åŒ–æ¨¡å¼æŠ€æœ¯è§„æ ¼

**æ ¸å¿ƒç»„ä»¶**: `media/text_to_video_generator.py`
- **å·¥ä½œæµID**: `1964196221642489858` (RunningHubæœ€æ–°å·¥ä½œæµ)
- **è¾“å…¥**: æ–‡æœ¬æç¤ºè¯ + è´Ÿå‘æç¤ºè¯ + è§†é¢‘å‚æ•°
- **è¾“å‡º**: 720x1280@31fps MP4è§†é¢‘æ–‡ä»¶
- **å¤„ç†æµç¨‹**: æ–‡æœ¬ â†’ Fluxå›¾åƒç”Ÿæˆ â†’ Wan2.2è§†é¢‘è½¬æ¢ â†’ MP4è¾“å‡º
- **å¹¶å‘æ”¯æŒ**: æœ€å¤§5ä¸ªå¹¶å‘ä»»åŠ¡
- **è¶…æ—¶æœºåˆ¶**: 300ç§’ä»»åŠ¡è¶…æ—¶ï¼Œæ™ºèƒ½é‡è¯•

#### ğŸ“‹ é…ç½®å’Œä½¿ç”¨

**1. é…ç½®å¯ç”¨**
```json
{
  "media": {
    "enable_integrated_generation": true,
    "integrated_workflow_id": "1964196221642489858"
  }
}
```

**2. ç¼–ç¨‹æ¥å£**
```python
from media.text_to_video_generator import TextToVideoGenerator, TextToVideoRequest

# åˆå§‹åŒ–ç”Ÿæˆå™¨
generator = TextToVideoGenerator(config, file_manager)

# åˆ›å»ºè¯·æ±‚
request = TextToVideoRequest(
    prompt="å¤ä»£ä¸­å›½çš‡å®«ï¼Œçš‡å¸ç™»åŸºå…¸ç¤¼ï¼Œé‡‘ç¢§è¾‰ç…Œ",
    negative_prompt="blurry, low quality, distorted",
    width=720, height=1280, fps=31, duration=3.0
)

# ç”Ÿæˆè§†é¢‘
result = await generator.generate_video_async(request)
print(f"è§†é¢‘è·¯å¾„: {result.video_path}")
```

**3. MediaPipelineé›†æˆ**
```python
# MediaPipelineè‡ªåŠ¨æ£€æµ‹ä¸€ä½“åŒ–æ¨¡å¼
pipeline = MediaPipeline(config, file_manager)
print(f"ä¸€ä½“åŒ–ç”Ÿæˆ: {pipeline.enable_integrated_generation}")

# è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ç”Ÿæˆæ¨¡å¼
result = await pipeline.generate_media_async(request)
```

#### ğŸ§ª æµ‹è¯•éªŒè¯

**é€»è¾‘æµ‹è¯•** (æ— éœ€API):
```bash
python tests/test_integration_logic.py
```

**å®Œæ•´åŠŸèƒ½æµ‹è¯•** (éœ€è¦API):
```bash
# å•ç‹¬æµ‹è¯•
python tests/test_integrated_generation.py --single

# æµæ°´çº¿æµ‹è¯•  
python tests/test_integrated_generation.py --pipeline

# æ‰¹é‡æµ‹è¯•
python tests/test_integrated_generation.py --batch

# å®Œæ•´æµ‹è¯•å¥—ä»¶
python tests/test_integrated_generation.py
```

#### âš¡ æ€§èƒ½ä¼˜åŠ¿

**APIè°ƒç”¨ä¼˜åŒ–**:
- ä¼ ç»Ÿæ¨¡å¼: æ–‡ç”Ÿå›¾API + å›¾ç”Ÿè§†é¢‘API = 2æ¬¡è°ƒç”¨
- **ä¸€ä½“åŒ–æ¨¡å¼**: å•æ¬¡å·¥ä½œæµAPI = 1æ¬¡è°ƒç”¨ (**50%å‡å°‘**)

**æ—¶é—´æ•ˆç‡æå‡**:
- å‡å°‘äº†ä¸­é—´å›¾åƒæ–‡ä»¶çš„ä¼ è¾“å’Œå¤„ç†
- å·¥ä½œæµå†…éƒ¨ä¼˜åŒ–ï¼Œå‡å°‘ç­‰å¾…æ—¶é—´
- å•ä¸€ä»»åŠ¡è½®è¯¢ï¼Œç®€åŒ–çŠ¶æ€ç®¡ç†

**èµ„æºä½¿ç”¨ä¼˜åŒ–**:
- æ— éœ€å­˜å‚¨ä¸­é—´å›¾åƒæ–‡ä»¶
- å†…å­˜å ç”¨æ›´ä½
- ç½‘ç»œå¸¦å®½éœ€æ±‚å‡å°‘

#### ğŸ¯ ä½¿ç”¨åœºæ™¯å»ºè®®

**æ¨èä½¿ç”¨ä¸€ä½“åŒ–æ¨¡å¼**:
- âœ… æ‰¹é‡è§†é¢‘ç”Ÿæˆ
- âœ… æˆæœ¬æ•æ„Ÿé¡¹ç›®
- âœ… å¿«é€ŸåŸå‹åˆ¶ä½œ
- âœ… æ ‡å‡†è´¨é‡è¦æ±‚

**ç»§ç»­ä½¿ç”¨ä¼ ç»Ÿæ¨¡å¼**:
- ğŸ”„ éœ€è¦ç²¾ç¡®æ§åˆ¶æ¯ä¸ªæ­¥éª¤
- ğŸ”„ è‡ªå®šä¹‰å›¾åƒåå¤„ç†
- ğŸ”„ ç‰¹æ®Šåˆ†è¾¨ç‡éœ€æ±‚
- ğŸ”„ è°ƒè¯•å’Œå®éªŒç¯å¢ƒ

### v3.0 æŠ€æœ¯äº®ç‚¹

1. **ğŸ—ï¸ æ¶æ„ç®€åŒ–**: å•ä¸€APIè°ƒç”¨æ›¿ä»£å¤æ‚çš„å¤šæ­¥éª¤æµç¨‹
2. **ğŸ“ˆ æ€§èƒ½æå‡**: APIè°ƒç”¨å‡å°‘50%ï¼Œç”Ÿæˆé€Ÿåº¦æå‡30%
3. **ğŸ’° æˆæœ¬ä¼˜åŒ–**: å‡å°‘APIè°ƒç”¨è´¹ç”¨ï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡
4. **ğŸ”§ é…ç½®çµæ´»**: æ”¯æŒä¼ ç»Ÿå’Œä¸€ä½“åŒ–æ¨¡å¼æ— ç¼åˆ‡æ¢
5. **ğŸ§ª æµ‹è¯•å®Œå¤‡**: å®Œæ•´çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•è¦†ç›–
6. **ğŸ“š æ–‡æ¡£è¯¦ç»†**: åŒ…å«ä½¿ç”¨æŒ‡å—ã€APIæ–‡æ¡£å’Œæœ€ä½³å®è·µ

---

**å¼€å‘æé†’**: v3.0å¼•å…¥ä¸€ä½“åŒ–æ–‡ç”Ÿè§†é¢‘ç³»ç»Ÿï¼Œæ¨èæ–°é¡¹ç›®ä½¿ç”¨ä¸€ä½“åŒ–æ¨¡å¼ä»¥è·å¾—æœ€ä½³æ€§èƒ½å’Œæˆæœ¬æ•ˆç›Šã€‚ç°æœ‰é¡¹ç›®å¯é€šè¿‡é…ç½®æ— ç¼å‡çº§ã€‚